#!/usr/bin/env sh
# è¯»å–æäº¤ä¿¡æ¯æ–‡ä»¶çš„è·¯å¾„
COMMIT_MSG_FILE="$1"

# ä½¿ç”¨ commitlint æ ¡éªŒæäº¤ä¿¡æ¯
pnpm exec commitlint --edit $COMMIT_MSG_FILE
if [ $? -ne 0 ]; then
  echo "Commit message linting failed."
  exit 1
fi

# å®šä¹‰ emoji å’Œ type çš„æ˜ å°„å…³ç³»
feat="ðŸŽ‰"
optimize="âœ¨"
fix="ðŸ”§"
revert="âªï¸"

# ä»Žæäº¤ä¿¡æ¯ä¸­æå–ç±»åž‹ï¼ˆå‡è®¾æ ¼å¼ä¸º "type(scope): description"ï¼‰
TYPE=$(grep -oE '^[a-z]+' $COMMIT_MSG_FILE)

# æ ¹æ®ç±»åž‹åŒ¹é… emoji è¡¨æƒ…
case "$TYPE" in
  feat)     EMOJI=$feat ;;
  optimize) EMOJI=$optimize ;;
  fix)      EMOJI=$fix ;;
  revert)   EMOJI=$revert ;;
esac

# è¯»å–åŽŸå§‹æäº¤ä¿¡æ¯
COMMIT_MSG=$(cat $COMMIT_MSG_FILE)

# æ·»åŠ  emoji åˆ°æäº¤ä¿¡æ¯å‰é¢
NEW_COMMIT_MSG="$EMOJI $COMMIT_MSG"

# å°†æ›´æ–°åŽçš„æäº¤ä¿¡æ¯å†™å›žæ–‡ä»¶
echo "$NEW_COMMIT_MSG" > $COMMIT_MSG_FILE
